<html>
	<head>
	</head>
	<body>
		<div>{{msg}}</div><br>
		<form method = "post">
			<input type = "text" name = "community_name" placeholder = "community_name"><br>
			<input type = "text" name = "username" placeholder = "username"><br>
			<input type = "password" name = "password" placeholder = "password"><br>
			<input type = "submit" value = "submit">
		</form>
		<div id="signInButton">
          <span class="g-signin"
            data-scope="openid email"
            data-clientid="883863186511-uik1o4dbog2vqe578etk0jblrfp94av3.apps.googleusercontent.com"
            data-redirecturi="postmessage"
            data-accesstype="offline"
            data-cookiepolicy="single_host_origin"
            data-callback="signInCallback"
            data-approvalprompt="force">
          </span>
        </div>
        <br><br>
		<br><br>
		<a href="/signin"><button name="signin">Sign</button></a>
        <div id="result"></div>

		<script>
			function signInCallback(authResult) {
				if (authResult['code']) {
					// Hide the sign-in button now that the user is authorized
					$('#signinButton').attr('style', 'display: none');
					// Send the one-time-use code to the server, if the server responds, write a 'login successful' message to the web page and then redirect back to the main restaurants page
					$.ajax({
						type: 'POST',
						url: '/gconnect?state={{STATE}}',
						processData: false,
						data: authResult['code'],
						contentType: 'application/octet-stream; charset=utf-8',
						success: function(result) {
							// Handle or verify the server response if necessary.
							if (result) {
								$('#result').html('Login Successful!</br>'+ result + '</br>Redirecting...')
								setTimeout(function() {
									window.location.href = "/restaurant";
								}, 4000);					  
							}
							else if (authResult['error']) {
								console.log('There was an error: ' + authResult['error']);
							}
							else {
								$('#result').html('Failed to make a server-side call. Check your configuration and console.');
							}
						}			      
					}); 
				}
			}
		</script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
		</script>
		<script src="https://apis.google.com/js/client:platform.js?onload=start" async defer></script>
		<script type="text/javascript">
			$(window).bind('beforeunload', function(){
				$.ajax({
					type:"GET",
					vara:"ajax",
					url:"/logoutcheck",
					success: function (response) {
                    if (response.d == 0) {
                        logoutSucks();
	                    }
	                },
					dataType:'html'
				});
			});
			function logoutSucks() {
				console.log('this sucks')
			}
		</script>
	</body>
</html>